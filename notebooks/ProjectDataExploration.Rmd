---
title: "ProjectDataExploration"
date: "2025-04-01"
output: html_document
---

```{r setup, include=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(lubridate)
library(gt)

# importing dataset with data for all repos (no qualitfying filter)
allRepos <- read_csv("../data/repos.csv")

# creating datetime object with current date
current_date <- as_datetime("2025-04-01 09:00:00")


# casting date cols to date format
allRepos$repo_cursor_adoption <- as_datetime(allRepos$repo_cursor_adoption)
allRepos$repo_created <- as_datetime(allRepos$repo_created)
allRepos$repo_updated <- as_datetime(allRepos$repo_updated)

# importing dataset with cursor rules for all repos (no qualitfying filter)
allCursorFiles <- read_csv("../data/cursor_files.csv")


knitr::opts_chunk$set(echo = TRUE)
```


```{r}

# looking at how many of the rules came from projects with at least 10 stars
allCursorFiles %>% filter(repo_name %in% atLeast10Stars$repo_name)





# generating random sample of 100 cursor rules
# from subset of cursor rules coming from projects with at least 10 stars
set.seed(111611)

atLeast10Stars <- allRepos %>% filter(repo_stars > 10)

cursorRulesFrom10StarPlusProjects <- allCursorFiles %>% filter(repo_name %in% atLeast10Stars$repo_name)

randomSample <- cursorRulesFrom10StarPlusProjects[sample(nrow(cursorRulesFrom10StarPlusProjects), 100), ]

# writing random sample to csv
write.csv(randomSample, "../data/cursor_rules_randomSample.csv", row.names=TRUE, quote=FALSE)

```

```{r}
#  since not all the rules pulled qualified (mostly because they're not in engligh)
# I'm generating another backup random sample to pull from when we need to get a replacemement

randomSampleBackup <- cursorRulesFrom10StarPlusProjects[sample(nrow(cursorRulesFrom10StarPlusProjects), 100), ]

# writing random sample to csv
write.csv(randomSampleBackup, "../data/cursor_rules_randomSample_backup.csv", row.names=TRUE, quote=FALSE)

```



# Exploring identified projects

## data setup
```{r}
# creating col calculating how long each project has been using cursor for (how much time has elapsed since adoption)
allRepos <- allRepos %>% mutate(elapsedDaysSinceCursorAdoption = as.numeric(current_date - allRepos$repo_cursor_adoption, units = "days"))

# creating col calculating how long the project existed before adopting cursor (time delta b/w repo creation and cursor adoption date)
allRepos <- allRepos %>% mutate(elapsedDaysBeforeCursorAdoption = as.numeric(allRepos$repo_cursor_adoption - allRepos$repo_created, units = "days"))

```



## data exploration

### looking at the distribution of cursor adoption dates
```{r}
# Histogram of elapsed days since cursor adoption
ggplot(allRepos, aes(x = elapsedDaysSinceCursorAdoption)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "black") +
  theme_minimal() +
  labs(
    x = "Days Since Cursor Adoption",
    y = "Number of Projects",
    title = "Distribution of Time Since Cursor Adoption"
  ) +
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0))


# How many repos have been using cursor for at least 6 months?
reposW6moPlusUsage <- allRepos %>% filter(elapsedDaysSinceCursorAdoption >= 180)
# it looks like there are about 80 repos that have been using cursor for at least 6 months

# Among repos with at least 6 months of usage, what is the star distribution? Are there any with less than 10 stars?
reposW6moPlusUsage %>% filter(repo_stars >= 10)
# good news! it looks like so far all the projects that have been using cursor for at least 6 months have at least 10 stars


# assuming we don't find any more projects, how many projects in our same will have been using cursor for at least six months by August 3rd? (since the elapsedDaysSinceCursorAdoption was calculated as of 4/3/25 and there are 122 days between 4/3/25 and 8/3/25 in order for the projects to have been using cursor for at least 6 months (180 days) their current elapsedDaysSinceCursorAdoption has to be 180-122 = 58 days)

allRepos %>% filter(elapsedDaysSinceCursorAdoption >= 58 & repo_stars >= 10)
# there are 360 project that will have been using cursor for at least 6 months by 8/3/25 with at least 10 stars. This should be more than enough repos to have a sufficiently large sample for modeling


# how many projects will habe been using cursor for at least a year by August 3rd?
# meaning their current elapsed days would need to be 365 - 122 = 243
allRepos %>% filter(elapsedDaysSinceCursorAdoption >= 243 & repo_stars >= 10)
# there will only be 10 repos that have been using cursor for a year by august, so it looks like 6 months is probably our best bet for right now


```

### looking at PL distribution

#### repos w/ >= 10 stars: distribution of primary language
```{r}
# Create bar plot of primary languages
ggplot(allRepos %>% filter(repo_stars >= 10), aes(x = reorder(repo_primary_language, repo_primary_language, function(x) -length(x)))) +
  geom_bar() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(
    x = "Primary Language",
    y = "Number of Projects",
    title = "Distribution of Primary Languages Across Projects"
  ) +
  scale_y_continuous(expand = c(0, 0))


# Creating table with count distribution for each PL in descending order
allRepos %>%
  filter(repo_stars >= 10) %>%
  group_by(repo_primary_language) %>%
  summarise(numRepos = n()) %>%
  arrange(desc(numRepos)) %>%
  gt() %>%
  tab_header(
    title = "Number of Projects by Primary Language"
  ) %>%
  cols_label(
    repo_primary_language = "Primary Language",
    numRepos = "Number of Repositories"
  )
```
Looking at the data, we can see that the vast majority of projects are have a primary language of typescript


#### repos w/ >= 10 stars & 6 mo usage: distribution of primary language
```{r}
# Create bar plot of primary languages
ggplot(allRepos %>% filter(repo_stars >= 10 & elapsedDaysSinceCursorAdoption >= 180), aes(x = reorder(repo_primary_language, repo_primary_language, function(x) -length(x)))) +
  geom_bar() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(
    x = "Primary Language",
    y = "Number of Projects",
    title = "Distribution of Primary Languages Across Projects"
  ) +
  scale_y_continuous(expand = c(0, 0))


# Creating table with count distribution for each PL in descending order
allRepos %>%
  filter(repo_stars >= 10 & elapsedDaysSinceCursorAdoption >= 180) %>%
  group_by(repo_primary_language) %>%
  summarise(numRepos = n()) %>%
  arrange(desc(numRepos)) %>%
  gt() %>%
  tab_header(
    title = "Number of Projects by Primary Language"
  ) %>%
  cols_label(
    repo_primary_language = "Primary Language",
    numRepos = "Number of Repositories"
  )

# if we only include repos that currently have at least 6 months of usage, 10 stars, and that have a primary language of typescript, javascript, or python, we'll have 51 repos in our dataset
```


#### repos w/ >= 10 stars & 6 mo usage by 8/3/25: distribution of primary language
```{r}
# Create bar plot of primary languages
ggplot(allRepos %>% filter(repo_stars >= 10 & elapsedDaysSinceCursorAdoption >= 58), aes(x = reorder(repo_primary_language, repo_primary_language, function(x) -length(x)))) +
  geom_bar() +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(
    x = "Primary Language",
    y = "Number of Projects",
    title = "Distribution of Primary Languages Across Projects"
  ) +
  scale_y_continuous(expand = c(0, 0))


# Creating table with count distribution for each PL in descending order
allRepos %>%
  filter(repo_stars >= 10 & elapsedDaysSinceCursorAdoption >= 58) %>%
  group_by(repo_primary_language) %>%
  summarise(numRepos = n()) %>%
  arrange(desc(numRepos)) %>%
  gt() %>%
  tab_header(
    title = "Number of Projects by Primary Language"
  ) %>%
  cols_label(
    repo_primary_language = "Primary Language",
    numRepos = "Number of Repositories"
  )

# if we only include repos that currently have at least 6 months of usage by 8/3/25, 10 stars, and that have a primary language of typescript, javascript, or python, we'll have 244 repos in our dataset
```




# Examine dataset structure to confirm adoption date fields
```{r}
# Convert repo_cursor_adoption to Date type
allRepos$repo_cursor_adoption <- as.Date(allRepos$repo_cursor_adoption)

ggplot(allRepos, aes(x = repo_cursor_adoption)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "black") +
  theme_minimal() +
  labs(
    title = "Distribution of Cursor Adoption Dates",
    x = "Adoption Date",
    y = "Number of Repositories"
  )

# Calculate time since adoption in different units
allRepos$days_since_adoption <- as.numeric(Sys.Date() - allRepos$repo_cursor_adoption)
allRepos$weeks_since_adoption <- allRepos$days_since_adoption / 7
allRepos$months_since_adoption <- allRepos$days_since_adoption / 30.44  # Average days per month

# Plot distribution of days since adoption
ggplot(allRepos, aes(x = days_since_adoption)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "black") +
  theme_minimal() +
  labs(
    title = "Distribution of Time Since Cursor Adoption",
    x = "Days Since Adoption",
    y = "Number of Repositories"
  )

# Plot distribution of weeks since adoption
ggplot(allRepos, aes(x = weeks_since_adoption)) +
  geom_histogram(bins = 30, fill = "darkgreen", color = "black") +
  theme_minimal() +
  labs(
    title = "Distribution of Time Since Cursor Adoption",
    x = "Weeks Since Adoption",
    y = "Number of Repositories"
  )

# Plot distribution of months since adoption
ggplot(allRepos, aes(x = months_since_adoption)) +
  geom_histogram(bins = 30, fill = "purple", color = "black") +
  theme_minimal() +
  labs(
    title = "Distribution of Time Since Cursor Adoption",
    x = "Months Since Adoption",
    y = "Number of Repositories"
  )
```
